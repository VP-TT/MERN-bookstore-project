// app.get is to get requests and respond, or to retrieve webpages
// app.post is used typically when you want to submit data to the server

// mongoose is an asynchronous process
// route for save a new book
app.post('/books',async(request, response)=>{
  try{
    if(
      !request.body.title||
      !request.body.author||
      !request.body.publishYear

    ){
      return response.status(400).send({
        message:'Send all required fields: title, author, publishYear'
      });
    }
    const newBook = {
      title: request.body.title,
      author: request.body.author,
      publishYear:request.body.publishYear
    };

    const book = await Book.create(newBook);
    return response.status(201).send(book);

  }catch(error){
    console.log(error.message);
    response.status(500).send({message: error.message});
  }

});
// app.listen(PORT, ()=>{
//   console.log(`App is listening on port: ${PORT} `)
// });

// route for get all books from database
app.get('/books',async (request, response)=>{
  try{
    const books = await Book.find({
      count: books.length,
      data: books
    });

    return response.status(200).json(books);
  }catch(error){
    console.log(error.message);
    response.status(500).send({message: error.message});
  }

});

// route for get one book from database
app.get('/books/:id',async (request, response)=>{
  try{
    const {id} = request.params;
    const book = await Book.findById(id);

    return response.status(200).json(book);
  }catch(error){
    console.log(error.message);
    response.status(500).send({message: error.message});
  }

});

// route to update a book
app.put('/books/:id',async (request, response)=>{
  try{
    if(
      !request.body.title||
      !request.body.author||
      !request.body.publishYear
    ){
      return response.status(400).send({
        message:"Send all required fields: title, author, publishYear"
      });
    }
    const {id} = request.params;
    const result = await Book.findByIdAndUpdate(id, request.body);

    if(!result){
      return response.status(404).send({message:"Book Not Found"});
    }
    return response.status(200).send({message:"Book Updated Successfully"});
  }catch(error){
    console.log(error.message);
    response.status(500).send({message: error.message});
  }

});

// route for deleting a book
app.delete('/books/:id',async (request, response)=>{
  try{
    const {id} = request.params;
    const result = await Book.findByIdAndDelete(id);
    if(!result){
      return response.status(404).send({message:"Book Not Found"});
    }
    return response.status(200).send({message:"Book Deleted Successfully"});

  }catch(error){
    console.log(error.message);
    response.status(500).send({message: error.message});
  }

});
